#!/bin/bash
# Main reference: https://github.com/RobotLocomotion/drake-external-examples/blob/main/scripts/setup/linux/ubuntu/jammy/install_prereqs
# Removed some unused dependencies

set -euxo pipefail

apt-get update
apt-get install --no-install-recommends -y lsb-release

if [[ "$(lsb_release -sc)" != 'jammy' ]]; then
  echo 'This script requires Ubuntu 22.04 (Jammy)' >&2
  exit 3
fi

apt-get install --no-install-recommends -y $(cat <<EOF
  ca-certificates
  wget
  gnupg

EOF
)

wget -qO- https://drake-apt.csail.mit.edu/drake.asc | gpg --dearmor - \
  | tee /etc/apt/trusted.gpg.d/drake.gpg >/dev/null


echo "deb [arch=amd64] https://drake-apt.csail.mit.edu/$(lsb_release -cs) $(lsb_release -cs) main" \
  | tee /etc/apt/sources.list.d/drake.list >/dev/null

apt-get install --no-install-recommends -y drake-dev


apt-get update
apt-get install --no-install-recommends -y $(cat <<EOF
  cmake
  default-jdk
  file
  gfortran
  git
  libblas-dev
  libclang-15-dev
  libeigen3-dev
  libgflags-dev
  libgl-dev
  libglib2.0-dev
  libglx-dev
  liblapack-dev
  libmumps-seq-dev
  libopengl-dev
  libspdlog-dev
  libx11-dev
  locales
  nasm
  ocl-icd-opencl-dev
  opencl-headers
  openssh-client
  patch
  patchelf
  pkg-config
  python-is-python3
  zlib1g-dev
EOF
)

locale-gen en_US.UTF-8

# Install pybind11 globally
pip3 install pybind11[global]
